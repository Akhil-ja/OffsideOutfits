<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Offside Outfits</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href=" /productAssets/User-icon.svg">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/plugins/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="assets/css/plugins/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/plugins/nouislider/nouislider.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">


</head>

<body>
    <div class="page-wrapper">
        <header class="header ">
            <div class="header-middle">
                <div class="header-top">
                    <div class="container-fluid">
                        <div class="header-left m-4">

                        </div><!-- End .header-left -->

                        <div class="header-right">
                            <ul class="top-menu">
                                
                            </ul><!-- End .top-menu -->
                        </div><!-- End .header-right -->
                    </div><!-- End .container-fluid -->
                </div><!-- End .header-top -->

                <div class="header-middle ">
                    <div class="container-fluid">
                        <div class="header-left">


                            <a href="/home" class="logo">
                                <img src="assets/images/Logo1.png" alt="Molla Logo" width="50" height="25">
                            </a>

                            <nav class="main-nav">
                                <ul class="menu sf-arrows">
                                    <li class="megamenu-container ">
                                        <a href="/home" class="">Home</a>
                                    </li>
                                    <li class="">
                                        <a href="" class=" ">Shop</a>
                                    </li>
                                </ul>
                            </nav>
                        </div><!-- End .header-left -->

                        <div class="header-right">

                            

                            <a href="/wishlist" class="wishlist-link">
                                <i class="icon-heart-o"></i>
                            </a>

                            <div class=" cart-dropdown">
                                <a href="/cart" class="dropdown-toggle" role="button" aria-haspopup="true"
                                    aria-expanded="false" data-display="static">
                                    <i class="icon-shopping-cart"></i>
                                </a>
                            </div>

                            <div class=" cart-dropdown">
                                <a href="/profile" class="dropdown-toggle" role="button" aria-haspopup="true"
                                    aria-expanded="false" data-display="static">
                                    <i class="icon-user"></i>

                                </a>
                            </div>

                        </div><!-- End .header-right -->
                    </div><!-- End .container-fluid -->
                </div><!-- End .header-middle -->
            </div>
        </header><!-- End .header -->

        <main class="main">
            <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
                <div class="container">
                    <h1 class="page-title">My Account<span></span></h1>
                </div><!-- End .container -->
            </div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">

            </nav><!-- End .breadcrumb-nav -->
            <div class="page-content">
                <div class="dashboard">
                    <div class="container">
                        <div class="row">
                            <aside class="col-md-4 col-lg-3">
                                <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="tab-dashboard-link" data-toggle="tab"
                                            href="#tab-dashboard" role="tab" aria-controls="tab-dashboard"
                                            aria-selected="true">Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-orders-link" data-toggle="tab" href="#tab-orders"
                                            role="tab" aria-controls="tab-orders" aria-selected="false">Orders</a>
                                    </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="tab-wallet-link" data-toggle="tab" href="#tab-wallet" role="tab" aria-controls="tab-wallet"
                                        aria-selected="false">Wallet</a>
                                </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-address-link" data-toggle="tab" href="#tab-address"
                                            role="tab" aria-controls="tab-address" aria-selected="false">Adresses</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-account-link" data-toggle="tab" href="#tab-account"
                                            role="tab" aria-controls="tab-account" aria-selected="false">Change
                                            Password</a>
                                    </li>
                                    <li class="nav-item">
                                        <a style="color: red;" class="nav-link font-weight-bold" href="/logout">Sign
                                            Out</a>
                                    </li>
                                </ul>
                            </aside>

                            <div class="col-md-8 col-lg-9">
                                <div class="tab-content">

                                <div class="tab-pane fade show active" id="tab-dashboard" role="tabpanel" aria-labelledby="tab-dashboard-link">
                                    <span id="nameDisplay">
                                        <input type="text" id="userID" value="<%= userDetails._id %>" hidden>
                                        <span style="font-size: xx-large; font-weight: 700;">
                                            <%= userDetails.name %>
                                        </span>
                                        <i class="fas fa-edit edit-icon" onclick="toggleEditMode(nameInput)"></i>
                                    </span>
                                    <div id="nameInput" style="display: none;">
                                        <input type="text" id="nameEdit" value="<%= userDetails.name %>" />
                                        <button onclick="submitEdit('nameEdit', 'nameDisplay', nameInput)">Save</button>
                                        <div id="emptyNameError" style="color: red;"></div>
                                        <div id="invalidNameError" style="color: red;"></div>
                                    </div>
                                
                                    <p class="lead">
                                        <strong>Email:</strong>
                                        <%= userDetails.email %> <br>
                                            <strong>Phone:</strong>
                                            <span id="userPhone">
                                                <%= userDetails.phone %>
                                            </span>
                                    </p>
                                    <div id="phoneInput" style="display: none;">
                                        <input type="text" id="phoneEdit" value="<%= userDetails.phone %>" />
                                        <button onclick="submitEdit('phoneEdit', 'userPhone', phoneInput)">Save</button>
                                    </div>
                                
                                 
                                <p class="lead">
                                    <strong>Referral Code:</strong>
                                    <span id="couponDisplay">
                                        <%= userDetails.referralCode %>
                                    </span>
                                    <button class="btn btn-outline-dark btn-round ml-3 btn-smaller"
                                        onclick="copyToClipboard('couponDisplay')">Copy</button>
                                </p>

                                </div>




                                    <div class="tab-pane fade" id="tab-orders" role="tabpanel"
                                        aria-labelledby="tab-orders-link">



                            <div class="container-fluid">
                                <h2 class="title mb-3">Orders List</h2>
                            
                                <% if (AllOrders.length===0) { %>
                                    <p>You have not ordered anything yet.</p>
                                    <% } else { %>
                                        <ul class="list-group">
                                            <% AllOrders.forEach(order=> { %>
                                                <li class="list-group-item mb-3" onclick="window.location='/order-details?orderID=<%= order._id %>'"
                                                    style="cursor: pointer; border: 1px solid #dee2e6; border-radius: 2rem;">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div class="text-right">
                                                            <ul>
                                                                <% order.products.forEach(productInfo=> { %>
                                                                    <li>
                                                                        <%= productInfo.product.pname %>
                                                                    </li>
                                                                    <% }) %>
                                                            </ul>
                                                        </div>
                                                        <div>
                                                            <a href="/order-details?orderID=<%= order._id %>" class="text-decoration-none">
                                                                <strong>Order ID:</strong>
                                                                <%= order.orderID %>
                                                            </a>
                                                            <p class="mb-1">
                                                                <strong>Status:</strong>
                                                                <span
                                                                    class="badge <%= order.status === 'pending' ? 'badge-primary' : order.status === 'completed' ? 'badge-success' : order.status === 'returned' ? 'badge-warning' : order.status === 'cancelled' ? 'badge-danger' : order.status === 'delivered' ? 'badge-info' : 'badge-secondary' %>">
                                                                    <%= order.status %>
                                                                </span>
                                                            </p>
                                                            <p class="mb-0">
                                                                <strong>Order Date:</strong>
                                                                <%= new Date(order.orderDate).toLocaleDateString() %>
                                                            </p>
                                                        <p class="mb-0">
                                                            <strong>Order Total:</strong>
                                                            <span style="text-decoration: underline; color:blueviolet;">
                                                                <%= order.orderTotal.toFixed(1) %>
                                                            </span>
                                                        </p>

                                                        </div>
                                                    </div>
                                                </li>
                                                <% }); %>
                                        </ul>
                                        <% } %>
                            </div>

<% if (totalPages> 1) { %>
    <nav aria-label="Transaction navigation">
        <ul class="pagination justify-content-center">
            <% if (currentPage> 1) { %>
                <li class="page-item">
                    <a class="page-link" href="/profile?selected=orders&page=<%= currentPage - 1 %>"
                        aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
                <% } %>

                    <% for (let i=1; i <=totalPages; i++) { %>
                        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                            <a class="page-link" href="/profile?selected=orders&page=<%= i %>">
                                <%= i %>
                            </a>
                        </li>
                        <% } %>

                            <% if (currentPage < totalPages) { %>
                                <li class="page-item">
                                    <a class="page-link" href="/profile?selected=orders&page=<%= currentPage + 1 %>"
                                        aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                                <% } %>
        </ul>
    </nav>
    <% } %>



                                    </div>


    <% if (walletDetails) { %>
        <div class="tab-pane fade" id="tab-wallet" role="tabpanel" aria-labelledby="tab-wallet-link">
            <div class="wallet-info">
                <h4>Your Wallet</h4>
                <p class="balance">Balance: <b style="text-decoration: underline;">Rs:<%= walletDetails.money.toFixed(2) %>
                            /-</b></p>
                <p class="description">Manage your wallet by making deposits or withdrawals.</p>
            </div>

            <div class="wallet-actions">
                <a href="#" id="add-money-btn" class="btn btn-outline-primary">
                    <span>Add Money</span>
                    <i class="icon-long-arrow-right"></i>
                </a>
            </div>

            <div class="wallet-history mt-4">
                <h4>Last 3 Transactions</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                <tbody>
                <% const transactionsLength=walletDetails.transactions.length %>
                    <% const startIndex=Math.max(transactionsLength - 3, 0) %>
                        <% for (let i=transactionsLength - 1; i>= startIndex; i--) { %>
                            <% const transaction=walletDetails.transactions[i] %>
                                <tr>
                                    <td>
                                        <%= transaction.type %>
                                    </td>
                                    <td>Rs <%= transaction.amount.toFixed(2) %>/-</td>
                                    <td>
                                        <%= new Date(transaction.createdAt).toLocaleDateString() %>
                                    </td>
                                </tr>
                                <% } %>

                </tbody>

                </table>
            </div>

            <div class="wallet-actions mt-4">
                <a href="/walletHistory" class="btn btn-outline-dark btn-round">
                    <span>Full Wallet History </span>
                    <i class="icon-long-arrow-right"></i>
                </a>
            </div>
        </div>
        <% } else { %>
             <div class="tab-pane fade" id="tab-wallet" role="tabpanel" aria-labelledby="tab-wallet-link">
            <div class="wallet-info">
                <h4>Your Wallet</h4>
                <p class="balance">Balance: <b style="text-decoration: underline;">Rs: 0.00 /-</b></p>
                <p class="description">Manage your wallet by making deposits.</p>
            </div>
        
            <div class="wallet-actions">
                <a href="#" id="add-money-btn" class="btn btn-outline-primary">
                    <span>Add Money</span>
                    <i class="icon-long-arrow-right"></i>
                </a>
            </div>
        
            <div class="wallet-history mt-4">
                <h4>Last 3 Transactions</h4>
                <p>No transactions available.</p>
            </div>
        
            <div class="wallet-actions mt-4">
                <a href="/walletHistory" class="btn btn-outline-dark btn-round">
                    <span>Full Wallet History</span>
                    <i class="icon-long-arrow-right"></i>
                </a>
            </div>
        </div>
        <% } %>




                                    <div class="tab-pane fade" id="tab-address" role="tabpanel"
                                        aria-labelledby="tab-address-link">
                                        <p>The following addresses will be used on the checkout page by default.</p>

                                        <%if(pageinfo==="AddressSize"){%>
                                            <p style="color: red;">Error: Cannot add more than 4 addresses.</p>
                                            <script>
                                                document.addEventListener("DOMContentLoaded", function () {

                                                    var tabAddressLink = document.getElementById("tab-address-link");
                                                    tabAddressLink.click();
                                                });
                                            </script>

                                            <%}%>

                                                <div class="row">


                                                    <% if (matchingAddress && matchingAddress.address) { %>
                                                        <% for (const address of matchingAddress.address) { %>
                                                            <div class="col-lg-6">
                                                                <div class="card card-dashboard">
                                                                    <div class="card-body">
                                                                        <button
                                                                            style="height: 5px; width: 5px; font-size: xx-small;"
                                                                            onclick="deleteAddress('<%= address._id %>')"
                                                                            class="btn btn-outline-danger float-right">Delete</button>
                                                                        <h3 class="card-title">
                                                                            <%= address.type %> Address <br>

                                                                        </h3>
                                                                        <p>

                                                                            <%= address.AddName %><br>
                                                                                <%= address.House %><br>
                                                                                    <%= address.street %><br>
                                                                                        <%= address.city %><br>
                                                                                            <%= address.state %><br>
                                                                                                <%= address.PIN %> <br>
                                                                                                    <a
                                                                                                        href="/edit-address<%= address._id %>">Edit
                                                                                                        <i
                                                                                                            class="icon-edit"></i></a>
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <% } %>
                                                                <% } %>








                                                                    <div class="col-lg-6">
                                                                        <div class="card card-dashboard">
                                                                            <div class="card-body">
                                                                                <h3 class="card-title">Add Address</h3>
                                                                                <p>
                                                                                    <a href="/add-address">Add <i
                                                                                            class="icon-plus"></i></a>
                                                                                </p>
                                                                            </div><!-- End .card-body -->
                                                                        </div><!-- End .card-dashboard -->
                                                                    </div><!-- End .col-lg-6 -->
                                                </div>
                                    </div>
                                    <div class="tab-pane fade" id="tab-account" role="tabpanel"
                                        aria-labelledby="tab-account-link">

                                        <form id="changePasswordForm" method="post">
                                            <p id="errorMessage" style="color: red;"></p>
                                            <div class="row">

                                                <input type="text" class="form-control" value="<%=userDetails._id%>"
                                                    hidden name="userID">
                                                <div class="col-sm-5">
                                                    <label>Old Password *</label>
                                                    <input type="password" class="form-control" name="oldPassword"
                                                        required maxlength="20">
                                                </div><!-- End .col-sm-12 -->
                                            </div><!-- End .row -->

                                            <div class="row">
                                                <div class="col-sm-5">
                                                    <label>New Password *</label>
                                                <input type="password" class="form-control" name="newPassword" required maxlength="20"
                                                    pattern="^(?!\s+$)(?=.*\d)(?=.*[A-Z])\S{8,}$"
                                                    title="Password must contain at least one digit and one uppercase letter, and be at least 8 characters long. No spaces at the beginning or in the middle are allowed.">


                                                    <small class="form-text text-muted">
                                                        Password must contain at least one digit and one uppercase
                                                        letter, and be at least 8 characters
                                                        long.
                                                    </small>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-5">
                                                    <label>Confirm New Password *</label>
                                                    <input type="password" class="form-control"
                                                        name="confirmNewPassword" required maxlength="20"
                                                        pattern="^(?!\s+$)(?=.*\d)(?=.*[A-Z])\S{8,}$"
                                                        title="Password must contain at least one digit and one uppercase letter, and be at least 8 characters long">
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary mt-3">Change Password</button>
                                        </form>
                                    </div>
                                </div>

                                <%if(pageinfo==="Address"){%>
                                    <script>
                                        document.addEventListener("DOMContentLoaded", function () {

                                            var tabAddressLink = document.getElementById("tab-address-link");
                                            tabAddressLink.click();
                                        });
                                    </script>
                                    <%}%>


                                        <%if(pageinfo==="orders"){%>
                                            <script>
                                                document.addEventListener("DOMContentLoaded", function () {

                                                    var tabAddressLink = document.getElementById("tab-orders-link");
                                                    tabAddressLink.click();
                                                });
                                            </script>
                                            <%}%>

                                            <%if(pageinfo==="wallet"){%>
                                                <script>
                                                    document.addEventListener("DOMContentLoaded", function () {

                                                        var tabAddressLink = document.getElementById("tab-wallet-link");
                                                        tabAddressLink.click();
                                                    });
                                                </script>
                                                <%}%>
                                           

        </main>
    <footer class="footer footer-2">
        <div class="footer-middle">
            <div class="container">
                <div class="row justify-content-center"> <!-- Center aligning content -->
                    <div class="col-md-6">
                        <div class="widget widget-about text-center"> <!-- Center aligning content -->
                            <img style="margin-left: 120px;" src="assets/images/LogoFooter.png" class="footer-logo"
                                alt="Footer Logo" width="280" height="25">
                            <p>Offside Outfit is your premier destination for football jerseys, catering to the passion of
                                fans worldwide.
                                With a curated collection of high-quality gear representing teams from various leagues. Our
                                commitment to excellence ensures that every
                                garment is crafted with premium materials, guaranteeing comfort and durability on and off
                                the pitch.</p>
                        </div><!-- End .widget-about -->
                    </div><!-- End .col-md-6 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .footer-middle -->
    
        <div class="footer-bottom">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <p class="footer-copyright text-center">Copyright &copy; 2024 Offside Outfits. All Rights Reserved.
                        </p>
                    </div><!-- End .col-md-12 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .footer-bottom -->
    </footer>

       
    </div><!-- End .page-wrapper -->
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <!-- Mobile Menu -->

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/wNumb.js"></script>
    <script src="assets/js/bootstrap-input-spinner.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/nouislider.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
   

<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://cdn.jsdelivr.net/npm/notyf@3.0.0/notyf.min.js"></script>
    
    <script>

        window.onload = function () {
            window.scroll(0, window.innerHeight / 4.5);
        };
    </script>




    <script>

        function deleteAddress(addressId) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'You won\'t be able to revert this!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/add-delete?addressId=${addressId}`, {
                        method: 'GET',
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log(data.message);
                            Swal.fire('Deleted!', 'Your address has been deleted.', 'success').then(() => {

                                window.location.href = "/profile?selected=Address";
                            });
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            Swal.fire('Error!', 'Failed to delete the address.', 'error');
                        });
                }
            });
        }


    </script>


   <script>
    document.getElementById('changePasswordForm').addEventListener('submit', function (event) {
        event.preventDefault(); 
        const formData = new FormData(event.target);

        const jsonData = {};
        formData.forEach((value, key) => {
            jsonData[key] = value;
        });

        fetch('/change-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(jsonData),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Password changed successfully');
                    Swal.fire({
                        icon: 'success',
                        title: 'Password Changed',
                        text: 'Your password has been changed successfully!',
                    }).then(() => {
                        window.location.href = '/profile?selected=Address';
                    });
                } else {
                    console.error('Error:', data.errorMessage); 
                    if (data.errorMessage.includes("different from the old password")) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'New password must be different from the old password.',
                        });
                    } else {
                        document.getElementById('errorMessage').innerText = data.errorMessage;
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>




<script>
    async function submitEdit(inputId, displayId, inputContainerElement) {
        const inputValue = document.getElementById(inputId).value;
        const userID = document.getElementById('userID').value;
        const phoneNO=document.getElementById('phoneEdit').value
        const displayElement = document.getElementById(displayId);

        console.log("name >>" + inputValue);
        console.log("phone no >>" + phoneNO);

        if (inputValue.trim() === '') {
            emptyNameError.textContent = 'Name cannot be empty.';
            invalidNameError.textContent = '';
            return;
        }

       
        const nameRegex = /^[A-Za-z\s]+$/;
        if (!nameRegex.test(inputValue)) {
            emptyNameError.textContent = '';
            invalidNameError.textContent = 'Please enter a valid name with only letters.';
            return;
        }


        displayElement.textContent = inputValue;
        inputContainerElement.style.display = 'none';

        try {
            const response = await fetch('/edit-user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: inputValue,
                    userID: userID,
                    phone: phoneNO
                })
            });

            if (!response.ok) {
                throw new Error('Failed to update profile');
            }
           location.reload()
            console.log('Profile updated successfully');

        } catch (err) {
            console.error(err);
            alert('Failed to update profile');
        }
    }

    function toggleEditMode(inputContainerElement) {
        inputContainerElement.style.display = 'block';
    }
</script>

<script>
   document.getElementById('add-money-btn').addEventListener('click', function () {
        Swal.fire({
            title: 'Enter Amount',
            input: 'number',
            inputPlaceholder: 'Enter amount',
            showCancelButton: true,
            cancelButtonText: 'Cancel',
            confirmButtonText: 'Add',
            inputValidator: (value) => {
                if (!value || value <= 0) {
                    return 'Please enter a valid amount';
                }
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const amount = result.value;

                fetch('/addToWallet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ amount: amount }) 
                })
                    .then(response => response.json())
                    .then(res => {
                        console.log("Server Response:", res);

                        if (res.success) {
                            var options = {
                                "key": res.key_id,
                                "amount": res.amount,
                                "currency": "INR",
                                "name": res.name,
                                "description": res.msg,
                                "image": "https://dummyimage.com/600x400/000/fff",
                                "order_id": res.order_id,
                               "handler": function (response) {
                                    var amountPaid = res.amount;
                                    window.location.href = `/wallet/add?amount=${amountPaid}`;
                                },
                                "prefill": {
                                    "contact": res.contact,
                                    "name": res.name,
                                    "email": res.email
                                },
                                "notes": {
                                    "description": res.description
                                },
                                "theme": {
                                    "color": "#2300a3"
                                }
                            };

                            var razorpayObject = new Razorpay(options);

                            razorpayObject.on('payment.failed', function (response) {
                                alert("Payment Failed");
                            });

                            razorpayObject.open();
                        } else {
                            if (res.redirectURL) {
                                window.location.href = res.redirectURL;
                            } else {
                                alert("Order creation failed. Check console for details.");
                                console.error(res);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error during order logging:', error);
                        alert("Error during order logging. Check console for details.");
                    });
            }
        });
    });

</script>

<script>
   function copyToClipboard(elementId) {
        const couponText = document.getElementById(elementId).innerText.trim(); 
        const tempInput = document.createElement("input");
        tempInput.value = couponText;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);

        const toast = Toastify({
            text: 'Referral Code Copied to clipboard',
            duration: 3000,
            gravity: 'top',
            position: 'right',
            backgroundColor: 'linear-gradient(to right, #e0f7fa, #e0f7fa)',
        });

        toast.showToast();
        const toastElement = document.querySelector('.toastify');
        toastElement.style.color = 'black';
    }

</script>


   


</body>

</html>